define(["core/ajax","core/notification"],function(e,t){return{analyze:function(a,n,i){var o=document.getElementById("aiAnalysisModal"),l=document.getElementById("aiAnalysisLoading"),s=document.getElementById("aiAnalysisContent"),r=document.getElementById("aiAnalysisResult"),d=document.getElementById("aiAnalysisError"),c=document.getElementById("aiAnalysisErrorMsg"),u=document.getElementById("ai-analyze-btn");if(!o)return void t.addNotification({message:"AI Analysis modal not found",type:"error"});o.style.display="block",document.body.style.overflow="hidden",l.style.display="block",s.style.display="none",d.style.display="none",r.innerHTML="",u&&(u.disabled=!0,u.innerHTML='<i class="fa fa-spinner fa-spin"></i> Analyzing...');var m=e.call([{methodname:"mod_codeeditor_analyze_code",args:{code:a,language:n,output:i||"",context:"Code submission for grading"}}]);m[0].then(function(e){if(e.success){l.style.display="none",s.style.display="block";var t=e.analysis;t=t.replace(/^### (.*$)/gim,'<h3 style="color: #495057; margin-top: 20px; margin-bottom: 10px; font-size: 18px; font-weight: bold;">$1</h3>'),t=t.replace(/^## (.*$)/gim,'<h2 style="color: #495057; margin-top: 25px; margin-bottom: 15px; font-size: 20px; font-weight: bold; border-bottom: 2px solid #667eea; padding-bottom: 8px;">$1</h2>'),t=t.replace(/^# (.*$)/gim,'<h1 style="color: #495057; margin-top: 25px; margin-bottom: 15px; font-size: 24px; font-weight: bold;">$1</h1>'),t=t.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>"),t=t.replace(/```(\w+)?\n([\s\S]*?)```/gim,'<pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; overflow-x: auto; margin: 10px 0;"><code>$2</code></pre>'),t=t.replace(/`([^`]+)`/gim,'<code style="background: #f8f9fa; padding: 2px 6px; border-radius: 3px; font-family: monospace;">$1</code>'),t=t.replace(/^\- (.*$)/gim,'<li style="margin: 5px 0; padding-left: 10px;">$1</li>'),t=t.replace(/(<li.*<\/li>)/s,'<ul style="margin: 10px 0; padding-left: 25px;">$1</ul>'),t=t.replace(/\n\n/gim,'</p><p style="margin: 10px 0;">'),t='<p style="margin: 10px 0;">'+t+"</p>",r.innerHTML=t}else l.style.display="none",d.style.display="block",c.textContent=e.analysis||"Unknown error occurred"}).catch(function(e){l.style.display="none",d.style.display="block",c.textContent=e.message||"Failed to analyze code. Please try again."}).always(function(){u&&(u.disabled=!1,u.innerHTML='<i class="fa fa-robot"></i> AI Analyze')})}}});

