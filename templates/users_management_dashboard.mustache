<div class="users-management-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">Users Management</h1>
            <p class="dashboard-subtitle">Comprehensive user administration and management tools</p>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="overview">
                <i class="fa fa-chart-pie"></i>
                Overview
            </button>
            <button class="nav-tab" data-tab="create" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/create_user.php'">
                <i class="fa fa-user-plus"></i>
                Create User
            </button>
            <button class="nav-tab" data-tab="edit" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/edit_users.php'">
                <i class="fa fa-user-edit"></i>
                Edit Users
            </button>
            <button class="nav-tab" data-tab="assign" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/assign_school.php'">
                <i class="fa fa-school"></i>
                Assign to School
            </button>
            <button class="nav-tab" data-tab="upload" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/upload_users.php'">
                <i class="fa fa-upload"></i>
                Upload Users
            </button>
            <button class="nav-tab" data-tab="download" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/bulk_download.php'">
                <i class="fa fa-download"></i>
                Bulk Download
            </button>
            <button class="nav-tab" data-tab="events" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/training_events.php'">
                <i class="fa fa-calendar-check"></i>
                Training Events
            </button>
        </div>
    </div>

    <!-- Overview Tab Content -->
    <div class="tab-content active" id="overview-tab">
        <!-- Statistics Cards -->
        <div class="stats-cards-container">
            <div class="stats-card total-users clickable-card" onclick="openDetailPage('total_users')">
                <div class="card-icon">
                    <i class="fa fa-users"></i>
                </div>
                <div class="card-content">
                    <div class="card-number" id="total-users-count">{{total_users}}</div>
                    <div class="card-title">Total Users</div>
                    <div class="card-description">All registered users</div>
                </div>
                <div class="card-arrow">
                    <i class="fa fa-arrow-right"></i>
                </div>
            </div>

            <div class="stats-card active-users clickable-card" onclick="openDetailPage('active_users')">
                <div class="card-icon">
                    <i class="fa fa-bolt"></i>
                </div>
                <div class="card-content">
                    <div class="card-number" id="active-users-count">{{active_users}}</div>
                    <div class="card-title">Active Users</div>
                    <div class="card-description">Currently active users</div>
                </div>
                <div class="card-arrow">
                    <i class="fa fa-arrow-right"></i>
                </div>
            </div>

            <div class="stats-card pending-approvals clickable-card" onclick="openDetailPage('pending_approvals')">
                <div class="card-icon">
                    <i class="fa fa-clock"></i>
                </div>
                <div class="card-content">
                    <div class="card-number" id="pending-approvals-count">{{pending_approvals}}</div>
                    <div class="card-title">Pending Approvals</div>
                    <div class="card-description">Training events awaiting approval</div>
                </div>
                <div class="card-arrow">
                    <i class="fa fa-arrow-right"></i>
                </div>
            </div>

            <div class="stats-card department-managers clickable-card" onclick="openDetailPage('department_managers')">
                <div class="card-icon">
                    <i class="fa fa-building"></i>
                </div>
                <div class="card-content">
                    <div class="card-number" id="department-managers-count">{{department_managers}}</div>
                    <div class="card-title">Department Managers</div>
                    <div class="card-description">Users with manager role</div>
                </div>
                <div class="card-arrow">
                    <i class="fa fa-arrow-right"></i>
                </div>
            </div>

            <div class="stats-card recent-uploads clickable-card" onclick="openDetailPage('recent_uploads')">
                <div class="card-icon">
                    <i class="fa fa-folder"></i>
                </div>
                <div class="card-content">
                    <div class="card-number" id="recent-uploads-count">{{recent_uploads}}</div>
                    <div class="card-title">Recent Uploads</div>
                    <div class="card-description">Users uploaded this month</div>
                </div>
                <div class="card-arrow">
                    <i class="fa fa-arrow-right"></i>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="quick-actions-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fa fa-cog"></i>
                    Quick Actions
                </h3>
            </div>
            <div class="quick-actions-grid">
                <button class="quick-action-btn create-user" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/create_user.php'">
                    <div class="action-icon">
                        <i class="fa fa-user-plus"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Create New User</div>
                        <div class="action-subtitle">Click to access</div>
                    </div>
                </button>

                <button class="quick-action-btn bulk-upload" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/upload_users.php'">
                    <div class="action-icon">
                        <i class="fa fa-upload"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Bulk Upload</div>
                        <div class="action-subtitle">Click to access</div>
                    </div>
                </button>

                <button class="quick-action-btn export-users" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/bulk_download.php'">
                    <div class="action-icon">
                        <i class="fa fa-download"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Export Users</div>
                        <div class="action-subtitle">Click to access</div>
                    </div>
                </button>

                <button class="quick-action-btn approve-events" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/admin/training_events.php'">
                    <div class="action-icon">
                        <i class="fa fa-check"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Approve Events</div>
                        <div class="action-subtitle">Click to access</div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Recent User Activity Section -->
        <div class="recent-activity-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fa fa-history"></i>
                    Recent User Activity
                </h3>
            </div>
            <div class="activity-timeline">
                {{#recent_activity}}
                <div class="activity-item">
                    <div class="activity-bullet {{#activity_type}}{{#.}}user-created{{/.}}{{/activity_type}}"></div>
                    <div class="activity-content">
                        <div class="activity-text">{{activity_type}} {{firstname}} {{lastname}}</div>
                        <div class="activity-time">{{#timecreated}}{{.}}{{/timecreated}}</div>
                    </div>
                </div>
                {{/recent_activity}}
            </div>
        </div>
    </div>


</div>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
    box-sizing: border-box;
}

.users-management-dashboard {
    padding: 20px;
    max-width: 1800px;
    margin: 0 auto;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Header Styles */
.dashboard-header {
    background: #ffffff;
    border: 2px solid transparent;
    background-image:
        linear-gradient(#ffffff, #ffffff),
        linear-gradient(120deg, #7c3aed, #6366f1, #0ea5e9);
    background-origin: border-box;
    background-clip: padding-box, border-box;
    border-radius: 20px;
    padding: 25px 40px;
    margin-bottom: 30px;
    color: #333333;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    text-align: center;
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dashboard-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
   
}

@keyframes float {
    0%, 100% {
        transform: translateY(0px) rotate(0deg);
    }
    50% {
        transform: translateY(-20px) rotate(180deg);
    }
}

.dashboard-title {
    font-size: 2.4rem;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: #4c1d95;
    position: relative;
    z-index: 2;
    text-shadow: 0 2px 6px rgba(76, 29, 149, 0.25);
    
}

@keyframes titleGlow {
    from {
        text-shadow: 0 2px 4px rgba(123, 31, 162, 0.2);
    }
    to {
        text-shadow: 0 4px 12px rgba(123, 31, 162, 0.4);
    }
}

.dashboard-subtitle {
    font-size: 1rem;
    margin: 0;
    opacity: 0.8;
    position: relative;
    z-index: 2;
    font-weight: 400;
    color: #4f6ddf;
}

/* Navigation Tabs */
.dashboard-nav {
    margin-bottom: 30px;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.nav-tabs {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 16px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
    justify-content: stretch;
    align-items: center;
    width: 100%;
}

.nav-tab {
    background: #ffffff;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 14px 22px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-weight: 600;
    font-size: 0.95rem;
    color: #64748b;
    position: relative;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    min-width: 140px;
    white-space: nowrap;
    flex: 1 1 140px;
    justify-content: center;
}

.nav-tab::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
    transition: left 0.5s ease;
}

.nav-tab:hover::before {
    left: 100%;
}

.nav-tab:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    color: #475569;
    border-color: #cbd5e1;
    background: #f8fafc;
}

.nav-tab.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff;
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.35);
    font-weight: 700;
}

.nav-tab.active::before {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

.nav-tab.active:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    box-shadow: 0 10px 28px rgba(102, 126, 234, 0.45);
    transform: translateY(-3px);
}

.nav-tab i {
    font-size: 16px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.nav-tab:hover i {
    transform: scale(1.15);
}

.nav-tab.active i {
    color: #ffffff;
    transform: scale(1.1);
}

.nav-tab:active {
    transform: translateY(0);
    transition: transform 0.1s ease;
}

/* Statistics Cards */
.stats-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.stats-card {
    background: #ffffff;
    border-radius: 18px;
    padding: 30px;
    box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
    display: flex;
    align-items: center;
    gap: 24px;
    position: relative;
    border: 1px solid rgba(148, 163, 184, 0.35);
    transition: border-color 0.35s ease, box-shadow 0.35s ease, transform 0.35s ease;
}

.stats-card:hover {
    border-color: #a5b4fc;
    box-shadow: 0 25px 50px rgba(76, 81, 191, 0.18);
    transform: translateY(-4px);
}

/* Clickable card styles */
.clickable-card {
    cursor: pointer;
    position: relative;
    user-select: none;
}

.card-arrow {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    color: #667eea;
    opacity: 0.6;
    transition: all 0.3s ease;
    pointer-events: none;
}

/* Ensure card content doesn't interfere with click */
.clickable-card .card-content {
    pointer-events: none;
}

.clickable-card .card-icon {
    pointer-events: none;
}


.card-icon {
    width: 58px;
    height: 58px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    color: #ffffff;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
}

.total-users .card-icon { 
    background: linear-gradient(135deg, #6f42c1, #8e44ad);
}
.active-users .card-icon { 
    background: linear-gradient(135deg, #fd7e14, #e67e22);
}
.pending-approvals .card-icon { 
    background: linear-gradient(135deg, #6f42c1, #8e44ad);
}
.department-managers .card-icon { 
    background: linear-gradient(135deg, #6c757d, #495057);
}
.recent-uploads .card-icon { 
    background: linear-gradient(135deg, #ffc107, #f39c12);
}

.card-content {
    flex: 1;
}

.card-number {
    font-size: 2.6rem;
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 6px;
}

.card-title {
    font-size: 1rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.4px;
}

.card-description {
    font-size: 0.9rem;
    color: #6b7280;
    line-height: 1.4;
}

/* Quick Actions */
.quick-actions-section {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 20px;
    padding: 35px;
    margin-bottom: 30px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    
}

.quick-actions-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
    
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.section-header {
    margin-bottom: 25px;
    position: relative;
    z-index: 2;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-title i {
    color: #667eea;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    position: relative;
    z-index: 2;
}

.quick-action-btn {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border: none;
    border-radius: 15px;
    padding: 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 20px;
    text-align: left;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border: 1px solid transparent;
    transition: border-color 0.35s ease, box-shadow 0.35s ease, transform 0.35s ease;
}

.quick-action-btn:hover {
    border-color: #a5b4fc;
    box-shadow: 0 14px 32px rgba(90, 103, 216, 0.2);
    transform: translateY(-4px);
}

.action-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    position: relative;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.create-user .action-icon { 
    background: linear-gradient(135deg, #28a745, #20c997);
}
.bulk-upload .action-icon { 
    background: linear-gradient(135deg, #007bff, #6610f2);
}
.export-users .action-icon { 
    background: linear-gradient(135deg, #6f42c1, #e83e8c);
}
.approve-events .action-icon { 
    background: linear-gradient(135deg, #fd7e14, #ffc107);
}

.action-content {
    flex: 1;
}

.action-title {
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 8px;
    font-size: 1.1rem;
    transition: color 0.3s ease;
}

.action-subtitle {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
}

/* Recent Activity */
.recent-activity-section {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 20px;
    padding: 35px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.recent-activity-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.03) 0%, transparent 70%);
}

.activity-timeline {
    position: relative;
    z-index: 2;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 25px;
    position: relative;
    padding: 15px;
    border-radius: 12px;
    transition: all 0.3s ease;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.activity-item:hover {
    background: rgba(102, 126, 234, 0.05);
    transform: translateX(5px);
}

.activity-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 19px;
    top: 50px;
    width: 3px;
    height: 30px;
    background: linear-gradient(to bottom, #667eea, transparent);
    border-radius: 2px;
}

.activity-bullet {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6c757d, #495057);
    flex-shrink: 0;
    position: relative;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.activity-item:hover .activity-bullet {
    transform: scale(1.2);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.activity-bullet.user-created { 
    background: linear-gradient(135deg, #28a745, #20c997);
    animation: pulse 2s ease-in-out infinite;
}

.activity-bullet::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
}

.activity-content {
    flex: 1;
}

.activity-text {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    font-size: 1rem;
    transition: color 0.3s ease;
}

.activity-item:hover .activity-text {
    color: #667eea;
}

.activity-time {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
}

/* Tab Content */
.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-placeholder {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 20px;
    padding: 60px 40px;
    text-align: center;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.tab-placeholder::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
    animation: rotate 15s linear infinite;
}

.tab-placeholder h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.8rem;
    font-weight: 700;
    position: relative;
    z-index: 2;
}

.tab-placeholder p {
    color: #6c757d;
    margin: 0;
    font-size: 1.1rem;
    font-weight: 500;
    position: relative;
    z-index: 2;
}

/* Loading Animation */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(102, 126, 234, 0.3);
    border-radius: 50%;
    border-top-color: #667eea;
    animation: spin 1s ease-in-out infinite;
    margin-right: 10px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Success/Error Messages */
.message {
    padding: 15px 20px;
    border-radius: 10px;
    margin: 20px 0;
    font-weight: 600;
}

.message.success {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    color: #155724;
    border-left: 4px solid #28a745;
}

.message.error {
    background: linear-gradient(135deg, #f8d7da, #f5c6cb);
    color: #721c24;
    border-left: 4px solid #dc3545;
}

/* Responsive Design */
@media (max-width: 768px) {
    .users-management-dashboard {
        padding: 15px;
    }
    
    .dashboard-title {
        font-size: 2.2rem;
    }
    
    .dashboard-header {
        padding: 25px;
    }
    
    .nav-tabs {
        flex-direction: row;
        gap: 10px;
        padding: 15px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
    }
    
    .nav-tabs::-webkit-scrollbar {
        height: 6px;
    }
    
    .nav-tabs::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }
    
    .nav-tabs::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    .nav-tab {
        padding: 12px 18px;
        justify-content: center;
        min-width: 120px;
        flex: 0 0 auto;
        font-size: 0.9rem;
    }
    
    .nav-tab i {
        font-size: 14px;
    }
    
    .stats-cards-container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .stats-card {
        padding: 20px;
    }
    
    .quick-actions-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .quick-action-btn {
        padding: 20px;
    }
    
    .activity-item {
        padding: 12px;
        gap: 15px;
    }
}

@media (max-width: 480px) {
    .dashboard-title {
        font-size: 1.8rem;
    }
    
    .card-number {
        font-size: 2rem;
    }
    
    .action-icon {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .activity-bullet {
        width: 16px;
        height: 16px;
    }
}
</style>

<script>
// Enhanced animations and interactions
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    initializeTabs();
    
    // Add hover effects to cards
    initializeCardEffects();
    
    // Initialize auto-refresh
    initializeAutoRefresh();
});


function initializeTabs() {
    const tabs = document.querySelectorAll('.nav-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            // Check if this tab has an onclick handler (navigation tab)
            // If it does, let the onclick handle the navigation
            if (this.hasAttribute('onclick')) {
                return; // Let the onclick handler navigate
            }
            
            const targetTab = this.getAttribute('data-tab');
            
            // Add click animation
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
            
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(content => {
                content.classList.remove('active');
                content.style.opacity = '0';
            });
            
            // Add active class to clicked tab and corresponding content
            this.classList.add('active');
            const targetContent = document.getElementById(targetTab + '-tab');
            
            // Check if targetContent exists before accessing classList
            if (targetContent) {
                targetContent.classList.add('active');
                
                // Fade in new content
                setTimeout(() => {
                    targetContent.style.opacity = '1';
                }, 100);
            }
        });
    });
}

function initializeCardEffects() {
    // Hover effects removed for quick action buttons and stats cards
}

function initializeAutoRefresh() {
    // Auto-refresh every 30 seconds (silent - no success messages)
    setInterval(() => refreshDashboardStats(false), 30000);
    
    // Add refresh button functionality (manual - show messages)
    const refreshButtons = document.querySelectorAll('[data-refresh]');
    refreshButtons.forEach(button => {
        button.addEventListener('click', () => refreshDashboardStats(true));
    });
}

// Enhanced quick action handlers with loading states
function handleQuickAction(action) {
    const button = event.target.closest('.quick-action-btn');
    const originalContent = button.innerHTML;
    
    // Show loading state
    button.innerHTML = `
        <div class="loading-spinner"></div>
        <div class="action-content">
            <div class="action-title">Processing...</div>
            <div class="action-subtitle">Please wait</div>
        </div>
    `;
    button.disabled = true;
    
    fetch('{{config.wwwroot}}/theme/remui_kids/admin/users_management_dashboard.php?action=' + action)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showMessage(data.message, 'success');
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showMessage('An error occurred while processing your request.', 'error');
        })
        .finally(() => {
            // Restore original content
            button.innerHTML = originalContent;
            button.disabled = false;
        });
}

// Enhanced refresh function with animations
// showSuccessMessage: true for manual refresh, false for auto-refresh
function refreshDashboardStats(showSuccessMessage = false) {
    const cards = document.querySelectorAll('.stats-card');
    
    // Add loading animation to cards (only for manual refresh)
    if (showSuccessMessage) {
        cards.forEach(card => {
            card.style.opacity = '0.7';
            card.style.transform = 'scale(0.98)';
        });
    }
    
    fetch('{{config.wwwroot}}/theme/remui_kids/admin/users_management_dashboard.php?action=get_dashboard_stats')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Animate number updates
                animateNumberUpdate('total-users-count', data.total_users);
                animateNumberUpdate('active-users-count', data.active_users);
                animateNumberUpdate('pending-approvals-count', data.pending_approvals);
                animateNumberUpdate('department-managers-count', data.department_managers);
                animateNumberUpdate('recent-uploads-count', data.recent_uploads);
                
                // Only show success message for manual refreshes
                if (showSuccessMessage) {
                    showMessage('Dashboard updated successfully!', 'success');
                }
            }
        })
        .catch(error => {
            console.error('Error refreshing stats:', error);
            // Always show error messages
            showMessage('Failed to refresh dashboard data.', 'error');
        })
        .finally(() => {
            // Restore card animations (only if they were changed)
            if (showSuccessMessage) {
                cards.forEach(card => {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                });
            }
        });
}

function animateNumberUpdate(elementId, newValue) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    // Directly update the value without animation
    element.textContent = newValue;
}

function showMessage(text, type) {
    // Remove existing messages
    const existingMessages = document.querySelectorAll('.message');
    existingMessages.forEach(msg => msg.remove());
    
    // Create new message
    const message = document.createElement('div');
    message.className = `message ${type}`;
    message.textContent = text;
    
    // Insert at top of dashboard
    const dashboard = document.querySelector('.users-management-dashboard');
    dashboard.insertBefore(message, dashboard.firstChild);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        message.style.opacity = '0';
        message.style.transform = 'translateY(-20px)';
        setTimeout(() => message.remove(), 300);
    }, 5000);
}

// Add keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
            case 'r':
                e.preventDefault();
                refreshDashboardStats(true); // Manual refresh - show message
                break;
            case '1':
                e.preventDefault();
                document.querySelector('[data-tab="overview"]').click();
                break;
            case '2':
                e.preventDefault();
                document.querySelector('[data-tab="create"]').click();
                break;
        }
    }
});

// Add touch support for mobile
if ('ontouchstart' in window) {
    document.querySelectorAll('.stats-card, .quick-action-btn').forEach(element => {
        element.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
        });
        
        element.addEventListener('touchend', function() {
            this.style.transform = '';
        });
    });
}

// Function to open detail pages for cards
function openDetailPage(cardType) {
    const baseUrl = '{{config.wwwroot}}/theme/remui_kids/admin/';
    
    switch(cardType) {
        case 'total_users':
            window.location.href = baseUrl + 'detail_total_users.php';
            break;
        case 'active_users':
            window.location.href = baseUrl + 'detail_active_users.php';
            break;
        case 'pending_approvals':
            window.location.href = '{{config.wwwroot}}/admin/user/user_bulk.php';
            break;
        case 'department_managers':
            window.location.href = baseUrl + 'detail_department_managers.php';
            break;
        case 'recent_uploads':
            window.location.href = baseUrl + 'detail_recent_uploads.php';
            break;
        default:
            console.log('Unknown card type:', cardType);
    }
}
</script>
